# Hyperliquid-Non-Validator-Guide (ัะตะดะฐะบัะธััะตััั)
# ๐ฟ Hyperliquid Node โ ะะพัะฐะณะพะฒะพะต ะัะบะพะฒะพะดััะฒะพ ๐ฟ

## ๐ฉโ๐ป ะญัะพั ะณะฐะนะด ะฟะพะผะพะถะตั ัะฐะทะฒะตัะฝััั **Non-Validator ะฝะพะดั Hyperliquid Testnet** ะฝะฐ Ubuntu 24.04 LTS.
---
### ๐ ะกะพะดะตัะถะฐะฝะธะต ๐ฑ

1. [๐ ะขัะตะฑะพะฒะฐะฝะธั](#ััะตะฑะพะฒะฐะฝะธั)
2. [๐ ะะพะดะณะพัะพะฒะบะฐ ัะตัะฒะตัะฐ](#ะฟะพะดะณะพัะพะฒะบะฐ-ัะตัะฒะตัะฐ)
3. [๐ฅ ะฃััะฐะฝะพะฒะบะฐ HL-Visor](#ัััะฐะฝะพะฒะบะฐ-hl-visor)
4. [โ ะกะพะทะดะฐะฝะธะต ะบะพะฝัะธะณััะฐัะธะธ](#ัะพะทะดะฐะฝะธะต-ะบะพะฝัะธะณััะฐัะธะธ)
5. [โถ ะะฐะฟััะบ ะฝะพะดั ะฒัััะฝัั](#ะทะฐะฟััะบ-ะฝะพะดั-ะฒัััะฝัั)
6. [โก ะะฐะฟััะบ ัะตัะตะท systemd](#ะทะฐะฟััะบ-ัะตัะตะท-systemd)
7. [๐ ะะพะฝะธัะพัะธะฝะณ ะธ ะปะพะณะธัะพะฒะฐะฝะธะต](#ะผะพะฝะธัะพัะธะฝะณ-ะธ-ะปะพะณะธัะพะฒะฐะฝะธะต)
8. [โ ะงะฐััะพ ะฒัััะตัะฐััะธะตัั ะพัะธะฑะบะธ](#ัะฐััะพ-ะฒัััะตัะฐััะธะตัั-ะพัะธะฑะบะธ)
9. [๐ก ะะพะปะตะทะฝัะต ะบะพะผะฐะฝะดั](#ะฟะพะปะตะทะฝัะต-ะบะพะผะฐะฝะดั)

---
### ๐ ะขัะตะฑะพะฒะฐะฝะธั
* Ubuntu 24.04 LTS (ะธะปะธ Ubuntu 22.04 ั ะพะฑะฝะพะฒะปะตะฝะธะตะผ ะดะพ 24.04) ๐
* ะะธะฝะธะผัะผ 4 CPU, 8 GB RAM, 500 GB ัะฒะพะฑะพะดะฝะพะณะพ ะดะธัะบะฐ ๐พ
* ะะพััะพัะฝะฝะพะต ะฟะพะดะบะปััะตะฝะธะต ะบ ะธะฝัะตัะฝะตัั ั ะพัะบััััะผะธ ะฟะพััะฐะผะธ **4001-4002** ๐
* ะะพะปัะทะพะฒะฐัะตะปั `root` ะดะปั ัะฟัะพัะตะฝะธั ัััะฐะฝะพะฒะบะธ ๐ง
---
### ๐ ะะพะดะณะพัะพะฒะบะฐ ัะตัะฒะตัะฐ
1. ะะฑะฝะพะฒะปัะตะผ ัะธััะตะผั:
```bash
sudo apt update && sudo apt upgrade -y
sudo apt install curl wget gnupg lsb-release zstd -y
```
2. ะัะพะฒะตััะตะผ ะฒะตััะธั Ubuntu:
```bash
lsb_release -a
```
#### ะัะปะธ ะฝัะถะฝะพ ะพะฑะฝะพะฒะธัั ะฒะตััะธั Ubuntu 22.04 ะดะพ 24.0422, ะผะพะถะฝะพ ะฒัะฟะพะปะฝะธัั ะฟัะธะฝัะดะธัะตะปัะฝัะน ะฟะตัะตัะพะด ัะตัะตะท ัะผะตะฝั ัะตะฟะพะทะธัะพัะธะตะฒ (ะฝะฐะดัะถะฝะพ)
ะะตัะตะด ะพะฑะฝะพะฒะปะตะฝะธะตะผ ะฒ ัะฐะนะปะต /etc/update-manager/release-upgrades ัััะฐะฝะพะฒะธัั Prompt=normal
```bash. ๐ก ะะตะบะพะผะตะฝะดะฐัะธั ะฟะตัะตะด ะฐะฟะณัะตะนะดะพะผ, ะกะดะตะปะฐะน ัะตะทะตัะฒ:
```bash
sudo tar czf /root/backup-etc-$(date +%F).tar.gz /etc
```
ะัะปะธ ััะพ Proxmox VM โ ะฟัะพััะพ ัะพะทะดะฐะน snapshot ััะตะดััะฒะฐะผะธ Proxmox. ะะพัะปะต ะพะฑะฝะพะฒะปะตะฝะธั ะผะพะถะฝะพ ะฑัะดะตั ัะดะฐะปะธัั backup.
####โ๏ธ ะัะฟะพะปะฝัะน ัะพะปัะบะพ ะตัะปะธ ััะพ ัะธััะฐั Ubuntu 22.04, ะฝะต ะบะฐััะพะผะธะทะธัะพะฒะฐะฝะฝะฐั. 
```bash
sudo sed -i 's/jammy/noble/g' /etc/apt/sources.list
sudo apt update
sudo apt full-upgrade -y
```
#### ะะพ ะฒัะตะผั ัััะฐะฝะพะฒะบะธ ะฝัะถะฝะพ ะฑัะดะตั ะพัะฒะตัะธัั ะฝะฐ ะฝะตัะบะพะปัะบะพ ะฒะพะฟัะพั ัะธััะตะผั:
1. Restart services during package upgrades without asking? (ัะฐะทัะตัะธัั ะปะธ ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฟะตัะตะทะฐะฟััะบะฐัั ัะปัะถะฑั (service), ะตัะปะธ ะฒะพ ะฒัะตะผั ะพะฑะฝะพะฒะปะตะฝะธั ะทะฐััะพะฝััั ัะธััะตะผะฝัะต ะฑะธะฑะปะธะพัะตะบะธ (libc, libssl, libpam ะธ ั. ะด.), ัะตะบะพะผะตะฝะดัะตััั ะพัะฒะตัะธัั "Y"
2. crontab (Y/I/N/O/D/Z) [default=N] ? ะตัะปะธ ั ะฒะฐั ะฑัะปะธ ะฝะฐะทะฝะฐัะตะฝั ะทะฐะดะฐะฝะธั ะฒ crontab, ัะพ ะพัะฒะตัะฐะตะผ "N".
#### ะะพัะปะต ัััะฐะฝะพะฒะบะธ ัะดัะฐ ะธ ะฟะฐะบะตัะพะฒ:
```bash
sudo reboot
```
```bash
lsb_release -a
```
ะะถะธะดะฐะตะผัะน ะฒัะฒะพะด:
> -No LSB modules are available.
> -Distributor ID: Ubuntu
> -Description:    Ubuntu 24.04.3 LTS
> -Release:        24.04
> -Codename:       noble

### โ ะฃััะฐะฝะพะฒะบะฐ AWS CLI
```bash
sudo apt update
sudo apt install -y unzip curl python3 python3-pip
curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"
unzip awscliv2.zip
sudo ./aws/install
aws --version
```
---
### ๐ฅ ะฃััะฐะฝะพะฒะบะฐ HL-Visor ๐
1. ะกะบะฐัะธะฒะฐะตะผ ะฟัะฑะปะธัะฝัะน ะบะปัั Hyperliquid:
```bash
curl -O https://raw.githubusercontent.com/hyperliquid-dex/node/main/pub_key.asc
gpg --import pub_key.asc
```
2. ะกะบะฐัะธะฒะฐะตะผ ะฑะธะฝะฐัะฝะธะบ HL-Visor ะธ ะฟัะพะฒะตััะตะผ ะฟะพะดะฟะธัั:
```bash
ะกะบะฐัะธะฒะฐะตะผ ะฟัะฑะปะธัะฝัะน ะบะปัั Hyperliquid:
```bash
curl -L https://binaries.hyperliquid-testnet.xyz/Testnet/hl-visor -o hl-visor
curl -L https://binaries.hyperliquid-testnet.xyz/Testnet/hl-visor.asc -o hl-visor.asc
gpg --verify hl-visor.asc hl-visor
chmod a+x hl-visor
```
---
### โ ะกะพะทะดะฐะฝะธะต ะบะพะฝัะธะณััะฐัะธะธ
1. ะกะพะทะดะฐัะผ ะฟะฐะฟะบั ะธ ะบะพะฝัะธะณ:
```bash
mkdir -p ~/hl
echo '{"chain": "Testnet"}' > ~/hl/visor.json
```
2. ะะตะปะฐะตะผ ะฑะธะฝะฐัะฝะธะบ ะธัะฟะพะปะฝัะตะผัะผ:
```bash
chmod a+x ~/hl-visor
```
3. ะกะพะทะดะฐัะผ ะบะพะฝัะธะณััะฐัะธะพะฝะฝัะน ัะฐะนะป
```bash
nano /root/hl/visor.json
```
---
### โก ะะฐะฟััะบ ัะตัะตะท systemd ๐ฑ

1. ะกะพะทะดะฐัะผ ัะฐะนะป `/etc/systemd/system/hl-visor.service`:
```bash
```ini
[Unit]
Description=Hyperliquid hl-visor Non-Validator
After=network.target

[Service]
Type=simple
WorkingDirectory=/root/hl
ExecStart=/root/hl/hl-visor run-non-validator --write-trades --write-order-statuses --serve-eth-rpc
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```
2. ะะตัะตะทะฐะณััะถะฐะตะผ systemd ะธ ะทะฐะฟััะบะฐะตะผ ัะตัะฒะธั:
```bash
systemctl daemon-reload
systemctl enable --now hl-visor.service
systemctl status hl-visor -l
```
#### ๐ ะะพััะฝะตะฝะธะต ะบ ัะปะฐะณะฐะผ:
> --write-trades โ ัะพััะฐะฝัะตั ัะดะตะปะบะธ
> --write-order-statuses โ ััะฐััั ะพัะดะตัะพะฒ
> --write-fills โ ะทะฐะฟะพะปะฝะตะฝะธั (fill events)
> --serve-evm-rpc โ ะฒะบะปััะฐะตั RPC-ะธะฝัะตััะตะนั (ะฝะฐะฟัะธะผะตั, ะดะปั ะฒะฝะตัะฝะธั ะทะฐะฟัะพัะพะฒ)
> --serve-info โ ะทะฐะฟััะบะฐะตั ะธะฝัะพัะผะฐัะธะพะฝะฝัะน API
> --replica-cmds-style actions โ ะพะฑัะทะฐัะตะปัะฝัะน ะฟะฐัะฐะผะตัั, ะฑะตะท ะฝะตะณะพ ะฝะต ะทะฐะฟัััะธััั

#### ะัะปะธ ะฑะฐะบะตั ะพัะบััั, ะผะพะถะฝะพ ะฟะพะฟัะพะฑะพะฒะฐัั ัะบะฐัะฐัั ะพัััะดะฐ ะฝะฐะฟััะผัั:
```bash
cd /root/hl/hyperliquid_data
curl -s https://hyperliquid-archive.s3.amazonaws.com/Testnet/snapshot/latest.tar.zst -o latest.tar.zst
```
## โถ ะะฐะฟััะบ ะฝะพะดั ะฒัััะฝัั ๐ (ะฟะพ ะฝะตะพะฑัะพะดะธะผะพััะธ)
```bash
cd ~
./hl-visor run-non-validator --write-trades --write-order-statuses --serve-eth-rpc
``

## ะะฐะฟััะบ visor ะฒ ะฒะฐะปะธะดะฐัะพััะบะพะผ ัะตะถะธะผะต ๐

1๏ธโฃ ะะตะฝะตัะฐัะธั ะบะปััะฐ ะฒะฐะปะธะดะฐัะพัะฐ

ะัะปะธ ั ัะตะฑั ะตัั ะฝะตั ะบะปััะฐ, ะพะฑััะฝะพ ะดะตะปะฐัั ัะฐะบ (ะฒ ะฟัะธะผะตัะต ัะตัะตะท hl-visor CLI):

```bash
./hl-visor generate-keys
```
ะญัะพ ัะพะทะดะฐัั ะฟะฐัั ะบะปััะตะน:

ะัะธะฒะฐัะฝัะน โ ััะฐะฝะธััั ั ัะตะฑั ะธ ะฝะธะบะพะผั ะฝะต ะฟะพะบะฐะทัะฒะฐะน

ะัะฑะปะธัะฝัะน โ ะธัะฟะพะปัะทัะตััั ะฒ ัะตัะธ, ััะพะฑั ัะตะฑั ะธะดะตะฝัะธัะธัะธัะพะฒะฐัั ะบะฐะบ ะฒะฐะปะธะดะฐัะพัะฐ

ะะฑััะฝะพ ัะฐะนะปั ัะพััะฐะฝััััั ะฒ:

~/hl/keys/validator_priv.key
~/hl/keys/validator_pub.key

ะขะพะณะดะฐ ะดะปั .env ัั ัะบะฐะทัะฒะฐะตัั ะฟััั ะธะปะธ ัะฐะผ ะฟัะธะฒะฐัะฝัะน ะบะปัั ะฒ ะฟะตัะตะผะตะฝะฝะพะน:

VALIDATOR_PRIVATE_KEY=$(cat ~/hl/keys/validator_priv.key)

2๏ธโฃ ะัะปะธ ะฝะพะดะฐ non-validator

ะะปั ัะตััะพะฒะพะน ัะตัะธ ะธะปะธ ะฟัะพััะพ ัะธะฝััะพะฝะธะทะฐัะธะธ ะดะฐะฝะฝัั ะฟัะธะฒะฐัะฝัะน ะบะปัั ะฝะต ะฝัะถะตะฝ, ะฟะตัะตะผะตะฝะฝัั ะผะพะถะฝะพ ะพััะฐะฒะธัั ะฟัััะพะน:

VALIDATOR_PRIVATE_KEY=


ะขะพะณะดะฐ ะฝะพะดะฐ ัะฐะฑะพัะฐะตั ะฒ ัะตะถะธะผะต non-validator, ะฟัะพััะพ ะฟะพะดะบะปััะฐะตััั ะบ ะฟะธัะฐะผะธ ะธ ัะบะฐัะธะฒะฐะตั ะฑะปะพะบะธ.

๐ก ะกะพะฒะตั: ะบะปัั ะฒะฐะปะธะดะฐัะพัะฐ โ ะบะฐะบ ะฑะฐะฝะบะพะฒัะบะธะน ะฟะฐัะพะปั ะดะปั ัะตัะธ. ะะธะบะพะผั ะตะณะพ ะฝะต ะฟะพะบะฐะทัะฒะฐะน, ะธ ัะตะทะตัะฒะฝัั ะบะพะฟะธั ะดะตัะถะธ ะฒ ะฑะตะทะพะฟะฐัะฝะพะผ ะผะตััะต.

ะะฐะฟััะบ ะฒ ะฒะฐะปะธะดะฐัะพััะบะพะผ ัะตะถะธะผะต (ะฒัััะฝัั, ััะพะฑั ะฝะต ะฟััะฐัั systemd).

```bash
cd /root/hl
./hl-visor run-validator \
  --config /root/hl/non_validator_config.json \
  --visor /root/hl/visor.json \
  --gossip /root/hl/override_gossip_config.json
```
---
* ะะตัะฒะฐั ัะธะฝััะพะฝะธะทะฐัะธั ะผะพะถะตั ะทะฐะฝััั **30โ60 ะผะธะฝัั** โณ
* ะัะธะฑะบะธ ะฒะธะดะฐ `missing file: visor_abci_state.json` โ **ะฝะพัะผะฐะปัะฝัะต ะฝะฐ ััะฐััะต** ๐๐  
##  ๐ ะะพะฝะธัะพัะธะฝะณ ะธ ะปะพะณะธัะพะฒะฐะฝะธะต ๐ฑ

1. ะัะพัะผะพัั ะปะพะณะพะฒ ะฒ ัะตะฐะปัะฝะพะผ ะฒัะตะผะตะฝะธ:

```bash
journalctl -u hl-visor -f
```

2. ะัะพะฒะตัะบะฐ ะฟะพะดะบะปัััะฝะฝัั peers:

```bash
journalctl -u hl-visor | grep "connected to abci stream from" | awk '{print $NF}' | sort | uniq | wc -l
```

3. ะคะฐะนะป `visor_abci_state.json` ัะพะทะดะฐัััั ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฟะพัะปะต ัะธะฝััะพะฝะธะทะฐัะธะธ ๐ฑ

---

## โ ะงะฐััะพ ะฒัััะตัะฐััะธะตัั ะพัะธะฑะบะธ ๐

* `missing file: visor_abci_state.json` โ **ะฝะพัะผะฐ ะฝะฐ ััะฐััะต** ๐
* `early eof` / `no quorum app hash` โ ะฝะพะดะฐ ะตัั **ะฝะต ัะธะฝััะพะฝะธะทะธัะพะฒะฐะปะฐัั**
* `Failed to determine user credentials` โ ัะฑะตะดะธัะตัั, ััะพ ะฒ systemd ัะบะฐะทะฐะฝะพ `User=root` ๐ง

---

## ๐ก ะะพะปะตะทะฝัะต ะบะพะผะฐะฝะดั ๐๐งด

```bash
1. ะะพะปะธัะตััะฒะพ ะฐะบัะธะฒะฝัั peers
journalctl -u hl-visor | grep "connected to abci stream from" | awk '{print $NF}' | sort | uniq | wc -l

2. 
systemctl restart hl-visor
systemctl stop hl-visor
systemctl status hl-visor -l
journalctl -u hl-visor -f
```

---

> ๐ ะัััั ะฒะฐัะฐ ะฝะพะดะฐ ะฒัะตะณะดะฐ ะฑัะดะตั ัะธะฝััะพะฝะธะทะธัะพะฒะฐะฝะฐ, ะฐ ัะตัั โ ััะฐะฑะธะปัะฝะพะน! โจ
